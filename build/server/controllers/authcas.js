// Generated by CoffeeScript 1.9.3
var Login, log, printit;

Login = require('../models/login');

printit = require('printit');

log = printit({
  prefix: 'ent-isen',
  date: true
});

module.exports.logIn = function(req, res, next) {
  return Login.auth(req.body.username, req.body.password, function(err, status) {
    if (err) {
      log.error(err);
      return res.send({
        error: err
      });
    } else {
      return res.send({
        status: status
      });
    }
  });
};

module.exports.check = function(req, res, next) {
  return Login.request('all', function(err, logins) {
    if (err) {
      log.error(err);
      res.send({
        error: err
      });
    }
    if (logins.length > 0) {
      return res.send({
        isLoggedIn: true
      });
    } else {
      return res.send({
        isLoggedIn: false
      });
    }
  });
};

module.exports.getAuthUrl = function(req, res, next) {
  return Login.authRequest(req.params.pageid, function(err, authUrl) {
    if (err) {
      log.error(err);
      return res.send({
        error: err
      });
    } else {
      return res.send({
        url: authUrl
      });
    }
  });
};

module.exports.logout = function(req, res, next) {
  return Login.logAllOut(function(err, status) {
    if (err) {
      log.error(err);
      return res.send({
        error: err
      });
    } else {
      if (status) {
        return res.send('');
      }
    }
  });
};

module.exports.logInTest = function(req, res, next) {
  return Login.auth("brendan", "brendan", function(err, status) {
    if (err) {
      log.error(err);
      return res.send({
        error: err
      });
    } else {
      return res.send({
        status: status
      });
    }
  });
};
